# Vite 环境变量配置说明

## 问题：为什么在 .env.development 中还要写 NODE_ENV=development？

### 核心概念区分

#### 1. 文件名的作用
- `.env.development` 中的 `development` 是**文件加载条件**
- 告诉 Vite："当运行模式是 development 时，加载这个文件"
- 这不是环境变量，只是文件命名规则

#### 2. NODE_ENV 的作用
- `NODE_ENV=development` 是**实际的环境变量**
- 应用程序可以通过 `process.env.NODE_ENV` 读取这个值
- 许多第三方库依赖这个变量来判断运行环境

### 实际运行流程

```bash
# 当你运行开发命令时
npm run dev  # 或 yarn dev

# Vite 内部执行流程：
# 1. 检测到运行模式是 'development'
# 2. 查找并加载 .env.development 文件
# 3. 读取文件内容：NODE_ENV=development, VITE_APP_BASE_URL=...
# 4. 将这些变量注入到运行环境中
```

### 为什么需要显式指定 NODE_ENV？

#### 场景1：第三方库依赖
```javascript
// 许多库会检查 NODE_ENV
if (process.env.NODE_ENV === 'development') {
  console.log('开发模式：启用详细日志')
} else {
  console.log('生产模式：精简日志')
}

// React 也会根据 NODE_ENV 启用不同功能
// development: 启用开发工具、警告信息
// production: 优化性能、移除调试信息
```

#### 场景2：构建工具优化
```javascript
// Webpack、Vite 等构建工具会根据 NODE_ENV 进行优化
if (process.env.NODE_ENV === 'production') {
  // 启用代码压缩、tree shaking 等优化
}
```

#### 场景3：应用程序逻辑
```javascript
// 你的应用代码中可能需要判断环境
const apiUrl = process.env.NODE_ENV === 'development'
  ? 'http://localhost:8081'
  : 'https://api.production.com'
```

### 不同环境文件示例

#### .env.development
```bash
NODE_ENV=development
VITE_APP_BASE_URL=http://localhost:8081
VITE_APP_DEBUG=true
```

#### .env.production
```bash
NODE_ENV=production
VITE_APP_BASE_URL=https://api.yoursite.com
VITE_APP_DEBUG=false
```

#### .env.test
```bash
NODE_ENV=test
VITE_APP_BASE_URL=http://localhost:3001
VITE_APP_DEBUG=true
```

### 如果不指定 NODE_ENV 会怎样？

```bash
# 假设 .env.development 文件内容：
VITE_APP_BASE_URL=http://localhost:8081
# 没有 NODE_ENV=development

# 运行时可能出现的问题：
console.log(process.env.NODE_ENV) // 可能是 undefined 或其他值
```

**潜在问题**：
1. 第三方库无法正确识别运行环境
2. React 可能不会启用开发模式的特性
3. 构建工具可能不会应用正确的优化策略

### 最佳实践

#### 1. 明确指定环境变量
```bash
# .env.development
NODE_ENV=development
VITE_APP_BASE_URL=http://localhost:8081

# .env.production
NODE_ENV=production
VITE_APP_BASE_URL=https://api.production.com
```

#### 2. 使用 TypeScript 类型声明
```typescript
// vite-env.d.ts
interface ImportMetaEnv {
  readonly NODE_ENV: 'development' | 'production' | 'test'
  readonly VITE_APP_BASE_URL: string
}
```

#### 3. 在代码中正确使用
```typescript
// 推荐：使用 import.meta.env（Vite 特有）
const isDev = import.meta.env.DEV
const baseURL = import.meta.env.VITE_APP_BASE_URL

// 传统方式：使用 process.env（需要额外配置）
const nodeEnv = process.env.NODE_ENV
```

### 总结

- **文件名**：`.env.development` 决定何时加载文件
- **环境变量**：`NODE_ENV=development` 是文件内容，供应用程序使用
- **两者作用不同**：文件名是加载规则，环境变量是运行时数据
- **都需要指定**：确保应用程序和第三方库能正确识别运行环境

这就像是"房间号"和"房间里的东西"的关系：
- 文件名是房间号（告诉你去哪个房间）
- NODE_ENV 是房间里的标签（告诉你这是什么环境）
